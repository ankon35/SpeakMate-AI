<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Speaking Test</title>
    <style>
        :root {
            --primary: #4F46E5;
            --secondary: #6366F1;
            --accent: #22D3EE;
            --dark: #0F172A;
            --gray: #64748B;
            --light: #F8FAFC;
            --success: #10B981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);
            background-attachment: fixed;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
            /* overflow: hidden; */
        }

        .bubble {
            position: fixed;
            bottom: -100px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            pointer-events: none;
            animation: rise linear infinite;
        }

        @keyframes rise {
            to {
                bottom: 110vh;
                transform: translateX(var(--drift)) rotate(360deg);
            }
        }

        .bubble:nth-child(1) {
            left: 10%;
            width: 80px;
            height: 80px;
            animation-duration: 15s;
            animation-delay: 0s;
            --drift: -50px;
        }

        .bubble:nth-child(2) {
            left: 25%;
            width: 50px;
            height: 50px;
            animation-duration: 12s;
            animation-delay: 2s;
            --drift: 30px;
        }

        .bubble:nth-child(3) {
            left: 40%;
            width: 100px;
            height: 100px;
            animation-duration: 18s;
            animation-delay: 4s;
            --drift: -80px;
        }

        .bubble:nth-child(4) {
            left: 55%;
            width: 60px;
            height: 60px;
            animation-duration: 14s;
            animation-delay: 1s;
            --drift: 60px;
        }

        .bubble:nth-child(5) {
            left: 70%;
            width: 90px;
            height: 90px;
            animation-duration: 16s;
            animation-delay: 3s;
            --drift: -40px;
        }

        .bubble:nth-child(6) {
            left: 85%;
            width: 70px;
            height: 70px;
            animation-duration: 13s;
            animation-delay: 5s;
            --drift: 20px;
        }

        .bubble:nth-child(7) {
            left: 15%;
            width: 40px;
            height: 40px;
            animation-duration: 11s;
            animation-delay: 6s;
            --drift: -30px;
        }

        .bubble:nth-child(8) {
            left: 50%;
            width: 55px;
            height: 55px;
            animation-duration: 17s;
            animation-delay: 2.5s;
            --drift: 70px;
        }

        .app-container {
            width: 100%;
            max-width: 1400px;
        }

        /* User Info Section */
        .user-info-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 50px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            margin: 0 auto;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .user-info-card.hidden {
            opacity: 0;
            transform: scale(0.9);
            display: none;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
        }

        .logo h1 {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 8px;
        }

        .logo p {
            color: var(--gray);
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 24px;
        }

        .input-group label {
            display: block;
            color: var(--dark);
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 16px 16px 16px 50px;
            border: 2px solid transparent;
            background: var(--light);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.1);
        }

        .input-group input.error {
            border-color: #EF4444;
        }

        .error-msg {
            color: #EF4444;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .error-msg.show {
            display: block;
        }

        .start-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 10px 30px rgba(79, 70, 229, 0.4);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(79, 70, 229, 0.5);
        }

        .start-btn:active {
            transform: translateY(-1px);
        }

        /* Test Interface */
        .test-container {
            display: none;
            opacity: 0;
        }

        .test-container.active {
            display: block;
            animation: fadeInUp 0.6s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
            }
        }

        .top-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 24px 32px;
            border-radius: 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .candidate-info h2 {
            font-size: 24px;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .candidate-info span {
            color: var(--gray);
            font-size: 14px;
        }

        .timer-widget {
            text-align: center;
        }

        .timer-display {
            font-size: 56px;
            font-weight: 900;
            background: linear-gradient(135deg, var(--success), #059669);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
            margin-bottom: 8px;
            transition: all 0.3s ease;
        }

        .timer-display.warning {
            background: linear-gradient(135deg, var(--accent), #0891b2);
        }

        .timer-display.danger {
            background: linear-gradient(135deg, #EF4444, #dc2626);
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .timer-label {
            color: var(--gray);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .progress-track {
            width: 200px;
            height: 8px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--success));
            border-radius: 10px;
            transition: width 1s linear, background 0.3s ease;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        .voice-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }

        .panel-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .recording-indicator {
            width: 16px;
            height: 16px;
            background: #EF4444;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.5;
                transform: scale(1.3);
            }
        }

        .panel-header h3 {
            font-size: 20px;
            color: var(--dark);
        }

        .ai-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }

        .wave-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(79, 70, 229, 0.05), rgba(99, 102, 241, 0.05));
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }

        .wave-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            height: 100%;
        }

        .wave-bar {
            width: 6px;
            background: var(--dark);
            border-radius: 10px;
            animation: wave 1s ease-in-out infinite;
        }

        .wave-bar:nth-child(1) { animation-delay: 0s; height: 40px; }
        .wave-bar:nth-child(2) { animation-delay: 0.1s; height: 60px; }
        .wave-bar:nth-child(3) { animation-delay: 0.2s; height: 80px; }
        .wave-bar:nth-child(4) { animation-delay: 0.3s; height: 100px; }
        .wave-bar:nth-child(5) { animation-delay: 0.4s; height: 120px; }
        .wave-bar:nth-child(6) { animation-delay: 0.5s; height: 140px; }
        .wave-bar:nth-child(7) { animation-delay: 0.6s; height: 120px; }
        .wave-bar:nth-child(8) { animation-delay: 0.7s; height: 100px; }
        .wave-bar:nth-child(9) { animation-delay: 0.8s; height: 80px; }
        .wave-bar:nth-child(10) { animation-delay: 0.9s; height: 60px; }
        .wave-bar:nth-child(11) { animation-delay: 1s; height: 40px; }

        @keyframes wave {
            0%, 100% {
                transform: scaleY(0.5);
                opacity: 0.7;
            }
            50% {
                transform: scaleY(1);
                opacity: 1;
            }
        }

        .ai-message {
            background: rgba(79, 70, 229, 0.1);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--primary);
            margin-bottom: 20px;
        }

        .ai-message-label {
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .ai-message-text {
            color: var(--dark);
            font-size: 15px;
            line-height: 1.6;
        }

        .finish-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--dark), var(--dark));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .finish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.4);
            background: linear-gradient(135deg, #1e293b, #1e293b);
        }

        .finish-btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
        }

        .transcript-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            height: 600px;
        }

        .transcript-panel h3 {
            color: var(--dark);
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .transcript-content {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .transcript-content::-webkit-scrollbar {
            width: 6px;
        }

        .transcript-content::-webkit-scrollbar-thumb {
            background: var(--gray);
            border-radius: 10px;
        }

        .transcript-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .transcript-entry {
            margin-bottom: 20px;
            animation: fadeInEntry 0.4s ease;
        }

        @keyframes fadeInEntry {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .transcript-entry.ai-entry {
            border-left: 4px solid var(--primary);
            background: linear-gradient(90deg, rgba(79, 70, 229, 0.08), transparent);
        }

        .transcript-entry.user-entry {
            border-left: 4px solid var(--accent);
            background: linear-gradient(90deg, rgba(34, 211, 238, 0.08), transparent);
        }

        .entry-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .entry-speaker {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 700;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .transcript-entry.ai-entry .entry-speaker {
            color: var(--primary);
        }

        .transcript-entry.user-entry .entry-speaker {
            color: var(--accent);
        }

        .speaker-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .transcript-entry.ai-entry .speaker-icon {
            background: var(--primary);
            color: white;
        }

        .transcript-entry.user-entry .speaker-icon {
            background: var(--accent);
            color: var(--dark);
        }

        .entry-time {
            font-size: 11px;
            color: var(--gray);
            font-family: 'Courier New', monospace;
        }

        .entry-content {
            padding: 16px;
            color: var(--dark);
            line-height: 1.7;
            font-size: 14px;
        }

        .download-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .download-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(79, 70, 229, 0.5);
        }

        /* Completion Screen */
        .completion-screen {
            display: none;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 80px 60px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            margin: 0 auto;
        }

        .completion-screen.show {
            display: block;
            animation: scaleIn 0.5s ease;
        }

        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .success-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, var(--success), var(--success));
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            color: white;
            margin-bottom: 32px;
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4);
        }

        .completion-screen h2 {
            font-size: 36px;
            color: var(--dark);
            margin-bottom: 16px;
        }

        .completion-screen p {
            font-size: 18px;
            color: var(--gray);
            line-height: 1.6;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .content-grid {
                grid-template-columns: 1fr;
            }

            .transcript-panel {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .user-info-card {
                padding: 32px;
            }

            .top-bar {
                flex-direction: column;
                gap: 24px;
                text-align: center;
            }

            .timer-display {
                font-size: 48px;
            }

            .chat-panel,
            .transcript-panel {
                height: 500px;
                padding: 24px;
            }

            .message-bubble.ai .bubble-content {
                margin-right: 20px;
            }

            .message-bubble.user .bubble-content {
                margin-left: 20px;
            }

            .completion-screen {
                padding: 60px 40px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 12px;
            }

            .user-info-card {
                padding: 24px;
            }

            .logo-icon {
                width: 60px;
                height: 60px;
                font-size: 30px;
            }

            .logo h1 {
                font-size: 24px;
            }

            .timer-display {
                font-size: 40px;
            }

            .message-bubble.ai .bubble-content,
            .message-bubble.user .bubble-content {
                margin-left: 0;
                margin-right: 0;
            }
        }
    </style>
</head>
<body>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    
    <div class="app-container">
        <!-- User Info Card -->
        <div class="user-info-card" id="userInfoCard">
            <div class="logo">
                <div class="logo-icon">🎙️</div>
                <h1>AI Speaking Test</h1>
                <p>Advanced Voice Assessment Platform</p>
            </div>

            <div class="input-group">
                <label>Full Name</label>
                <div class="input-wrapper">
                    <span class="input-icon">👤</span>
                    <input type="text" id="fullName" placeholder="Enter your full name">
                </div>
                <div class="error-msg" id="nameError">Please enter your full name</div>
            </div>

            <div class="input-group">
                <label>Candidate ID</label>
                <div class="input-wrapper">
                    <span class="input-icon">🆔</span>
                    <input type="text" id="candidateId" placeholder="Enter your candidate ID">
                </div>
                <div class="error-msg" id="idError">Please enter your candidate ID</div>
            </div>

            <button class="start-btn" onclick="startTest()">Begin Assessment</button>
        </div>

        <!-- Test Interface -->
        <div class="test-container" id="testContainer">
            <div class="top-bar">
                <div class="candidate-info">
                    <h2 id="displayName"></h2>
                    <span>ID: <span id="displayId"></span></span>
                </div>
                <div class="timer-widget">
                    <div class="timer-display" id="timerDisplay">160</div>
                    <div class="timer-label">Seconds Remaining</div>
                    <div class="progress-track">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>
            </div>

            <div class="content-grid">
                <div class="voice-panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <div class="recording-indicator"></div>
                            <h3>SpeakMate-AI</h3>
                        </div>
                        <div class="ai-avatar">🤖</div>
                    </div>
                    
                    <div class="wave-container">
                        <div class="wave-wrapper">
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                            <div class="wave-bar"></div>
                        </div>
                    </div>

                    <div class="ai-message" id="currentAiMessage">
                        <div class="ai-message-label">AI is asking:</div>
                        <div class="ai-message-text" id="aiMessageText">Initializing...</div>
                    </div>
                    
                    <button class="finish-btn" id="finishBtn" onclick="finishTest()">End Assessment</button>
                </div>

                <div class="transcript-panel">
                    <h3>📋 Conversation Transcript</h3>
                    <div class="transcript-content" id="transcriptContent"></div>
                    <button class="download-btn" onclick="downloadTranscript()">⬇ Download Transcript</button>
                </div>
            </div>
        </div>

        <!-- Completion Screen -->
        <div class="completion-screen" id="completionScreen">
            <div class="success-icon">✓</div>
            <h2>Assessment Complete!</h2>
            <p>Thank you for completing your speaking test.<br>Your performance has been recorded and will be evaluated by our team.</p>
        </div>
    </div>

    <script>
        let countdown;
        let timeRemaining = 160;
        let isTestActive = false;
        let transcript = [];
        
        const aiPrompts = [
            "Hello! Welcome to your speaking assessment. Let's begin by having you introduce yourself.",
            "That's wonderful. Could you elaborate on your educational qualifications and academic achievements?",
            "Interesting. What professional goals are you working towards in your career?",
            "Please describe a significant challenge you've encountered and explain how you resolved it.",
            "I'd like to know more about your personal interests. What hobbies do you enjoy in your free time?",
            "How do you typically manage stressful situations and maintain your productivity under pressure?",
            "Can you share an example of a successful team collaboration experience you've had?",
            "Finally, what do you consider to be the most critical skills for achieving success in your field?"
        ];

        const userAnswers = [
            "Good morning! My name is Sarah Johnson, and I'm delighted to participate in this assessment today.",
            "I graduated with honors from the University of California, earning my Bachelor's degree in Computer Science in 2021.",
            "My primary goal is to become a lead software architect and contribute to innovative technology solutions.",
            "During a critical project deadline, our system crashed. I coordinated with the team to implement a backup solution within 24 hours.",
            "I'm passionate about photography and digital art. I also enjoy competitive swimming and exploring new technologies.",
            "I use time management techniques and prioritize tasks effectively. Regular exercise and meditation help me stay focused.",
            "In my previous role, I led a cross-functional team of eight people to successfully launch a customer portal application.",
            "I believe adaptability, strong communication, continuous learning, and problem-solving abilities are fundamental to success."
        ];

        let currentIndex = 0;

        function startTest() {
            const name = document.getElementById('fullName').value.trim();
            const id = document.getElementById('candidateId').value.trim();
            let isValid = true;

            if (!name) {
                document.getElementById('fullName').classList.add('error');
                document.getElementById('nameError').classList.add('show');
                isValid = false;
            } else {
                document.getElementById('fullName').classList.remove('error');
                document.getElementById('nameError').classList.remove('show');
            }

            if (!id) {
                document.getElementById('candidateId').classList.add('error');
                document.getElementById('idError').classList.add('show');
                isValid = false;
            } else {
                document.getElementById('candidateId').classList.remove('error');
                document.getElementById('idError').classList.remove('show');
            }

            if (!isValid) return;

            document.getElementById('userInfoCard').classList.add('hidden');
            setTimeout(() => {
                document.getElementById('testContainer').classList.add('active');
                document.getElementById('displayName').textContent = name;
                document.getElementById('displayId').textContent = id;
                
                isTestActive = true;
                initTimer();
                beginConversation();
            }, 400);
        }

        function initTimer() {
            updateTimer();
            countdown = setInterval(() => {
                timeRemaining--;
                updateTimer();

                if (timeRemaining <= 0) {
                    clearInterval(countdown);
                    finishTest();
                }
            }, 1000);
        }

        function updateTimer() {
            const display = document.getElementById('timerDisplay');
            const bar = document.getElementById('progressBar');
            
            display.textContent = timeRemaining;
            
            const percent = (timeRemaining / 160) * 100;
            bar.style.width = percent + '%';

            display.className = 'timer-display';
            if (timeRemaining > 60) {
                bar.style.background = 'linear-gradient(90deg, var(--success), var(--success))';
            } else if (timeRemaining > 30) {
                display.classList.add('warning');
                bar.style.background = 'linear-gradient(90deg, var(--accent), var(--accent))';
            } else {
                display.classList.add('danger');
                bar.style.background = 'linear-gradient(90deg, #EF4444, #EF4444)';
            }
        }

        function beginConversation() {
            setTimeout(() => showAiMessage(aiPrompts[0]), 600);
            
            let delay = 4500;
            for (let i = 0; i < Math.min(aiPrompts.length, userAnswers.length); i++) {
                setTimeout(() => {
                    if (isTestActive) addUserResponse(userAnswers[i]);
                }, delay);
                delay += 5500;

                if (i + 1 < aiPrompts.length) {
                    setTimeout(() => {
                        if (isTestActive) showAiMessage(aiPrompts[i + 1]);
                    }, delay);
                    delay += 3500;
                }
            }
        }

        function showAiMessage(text) {
            if (!isTestActive) return;

            const messageEl = document.getElementById('aiMessageText');
            messageEl.textContent = text;
            
            const time = new Date().toLocaleTimeString();
            addTranscriptEntry('ai', text, time);
        }

        function addUserResponse(text) {
            if (!isTestActive) return;

            const time = new Date().toLocaleTimeString();
            addTranscriptEntry('user', text, time);
        }

        function addTranscriptEntry(type, text, time) {
            const container = document.getElementById('transcriptContent');
            
            const entry = document.createElement('div');
            entry.className = `transcript-entry ${type}-entry`;
            
            const speaker = type === 'ai' ? 'AI Assessor' : 'Your Response';
            const icon = type === 'ai' ? '🤖' : '👤';
            
            entry.innerHTML = `
                <div class="entry-header">
                    <div class="entry-speaker">
                        <div class="speaker-icon">${icon}</div>
                        ${speaker}
                    </div>
                    <div class="entry-time">${time}</div>
                </div>
                <div class="entry-content">${text}</div>
            `;
            
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
            
            // Store for download
            transcript.push({
                type: type,
                speaker: speaker,
                text: text,
                time: time
            });
        }

        function updateTranscript() {
            const transcriptBox = document.getElementById('transcriptContent');
            transcriptBox.scrollTop = transcriptBox.scrollHeight;
        }

        function finishTest() {
            if (!isTestActive) return;
            
            isTestActive = false;
            clearInterval(countdown);
            
            document.getElementById('finishBtn').disabled = true;
            document.getElementById('testContainer').style.display = 'none';
            document.getElementById('completionScreen').classList.add('show');
        }

        function downloadTranscript() {
            const name = document.getElementById('displayName').textContent;
            const id = document.getElementById('displayId').textContent;
            
            const header = `═══════════════════════════════════════════════\n  AI SPEAKING TEST - OFFICIAL TRANSCRIPT\n═══════════════════════════════════════════════\n\n`;
            const info = `Candidate Name: ${name}\nCandidate ID: ${id}\nTest Date: ${new Date().toLocaleDateString()}\nTest Time: ${new Date().toLocaleTimeString()}\n\n`;
            const divider = `───────────────────────────────────────────────\n\n`;
            
            let content = header + info + divider;
            
            transcript.forEach((entry, index) => {
                content += `[${entry.time}] ${entry.speaker}:\n`;
                content += `${entry.text}\n\n`;
                if (index < transcript.length - 1) {
                    content += `---\n\n`;
                }
            });
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `AI_Speaking_Test_${id}_${Date.now()}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>